(function(){define("model/authentication",[],function(){"use strict";var e=Backbone.Model.extend({initialize:function(){this.firebase=new Firebase("https://todium.firebaseIO.com/"),this.auth=new FirebaseAuthClient(this.firebase,_.bind(this.onLogin,this))},login:function(e){this.auth.login(e)},logout:function(){this.auth.logout()},onLogin:function(e,i){console.log("onLogin",e,i),this.set("user",i),e&&console.log(e)}});return e}),define("view/view",[],function(){"use strict";var e=Backbone.View.extend({assign:function(e,i){e.setElement(this.$(i)).render()}});return e}),define("view/login",["./view"],function(e){"use strict";var i=e.extend({events:{"click .signup_form .btn":"signUp","click .login_form .btn":"login"},initialize:function(){this.template=_.template($("#login_template").html()),this.model.on("change:user",this.render,this)},signUp:function(){var e=this.$(".signup_well .email").val(),i=this.$(".signup_well .password1").val();if(i!==this.$(".signup_well .password2").val())return console.error("mismatch passwords!"),void 0;var t=this.model.auth;console.log("create user",e,i),t.createUser(e,i,function(e,n){return e?(console.error(e),void 0):(console.log("User Id: "+n.id+", Email: "+n.email),t.login("password",{email:n.email,password:i,rememberMe:!0}),void 0)})},login:function(){var e=this.$(".login_well .email").val(),i=this.$(".login_well .password").val();console.log("login",e,i),this.model.auth.login("password",{email:e,password:i,rememberMe:!0})},render:function(){return this.model.get("user")?this.$el.hide():(this.$el.html(this.template()),this.$el.show()),this}});return i}),define("view/logout",["./view"],function(e){"use strict";var i=e.extend({events:{"click .logout.btn":"logout"},initialize:function(){this.template=_.template($("#logout_template").html()),this.model.on("change:user",this.render,this)},logout:function(e){var i=$(e.currentTarget);i.hasClass("disabled")||(i.addClass("disabled"),this.model.logout())},render:function(){return this.model.get("user")?(this.$el.html(this.template()),this.$el.show()):this.$el.hide(),this}});return i}),define("view/tracker",["./view"],function(e){"use strict";var i=new ZeroClipboard.Client;i.setHandCursor(!0),i.addEventListener("complete",function(){var e=$(i.domElement).prev();e.attr("value"," Copied to clipboard!"),setTimeout(function(){e.attr("value",e.attr("url"))},1e3)});var t=e.extend({events:{"mouseover .copy":"onCopy","click .button-label":"onAddLabel"},initialize:function(){this.url="...",this.template=_.template($("#tracker_template").html()),this.model.on("value",this.onValue,this)},destroy:function(){this.model.off("value",this.onValue,this)},onValue:function(e){console.log("onValue",e.val()),this.val=e.val(),this.render()},onAddLabel:function(){var e=this.$(".input-label").val();this.model.child("labels").push(e)},onCopy:function(){console.log("onCopy",this.url),i.setText(this.url);var e=this.$(".copy")[0];i.div?(i.receiveEvent("mouseout",null),i.reposition(e)):i.glue(e),i.receiveEvent("mouseover",null)},render:function(){return this.$el.html(this.template({src:this.val.src,time:humaneDate(new Date(this.val.time)),labels:this.val.labels,url:this.val.trackable})),this.url=this.val.trackable,this}});return t}),define("view/campaign",["./view","./tracker"],function(e,i){"use strict";var t=e.extend({events:{"click .addTracker":"onAddTracker"},initialize:function(){this.template=_.template($("#campaign_template").html()),this.views={},setTimeout(_.bind(function(){this.model.child("trackers").on("child_added",this.onTrackerAdded,this),this.model.child("trackers").on("child_removed",this.onTrackerRemoved,this)},this))},destroy:function(){this.model.child("trackers").off("child_added",this.onTrackerAdded,this),this.model.child("trackers").off("child_removed",this.onTrackerRemoved,this),_.each(this.views,function(e){e.destroy(),e.remove()}),this.views={}},onTrackerAdded:function(e){console.log("onTrackerAdded",e.val());var t=e.val(),n=this.model.parent().parent().child("trackers").child(t),s=new i({model:n});this.views[t]=s,this.$(".trackers").append(s.$el)},onTrackerRemoved:function(e){console.log("onTrackerRemoved",e.val());var i=e.val(),t=this.views[i];t.remove(),delete this.views[i]},onAddTracker:function(){var e=this.$(".btn");if(!e.hasClass("disabled")){e.addClass("disabled"),setTimeout(function(){e.removeClass("disabled")},3e3);var i=this.$(".createTorrentLink").val();i&&(this.$(".createTorrentLink").val(""),this.model.child("secret").once("value",function(e){var t=e.val();$.getJSON("http://api.todium.com",{id:this.model.name(),secret:t,src:i}).then(function(e){console.log(e)})},this))}},render:function(){return this.model.child("name").once("value",function(e){var i=this.$(".trackers").children().detach();this.$el.html(this.template({name:e.val()})),this.$(".trackers").append(i)},this),this}});return t}),define("view/user",["./view","./campaign"],function(e,i){"use strict";var t=e.extend({events:{"click .addCampaign":"onAddCampaign"},initialize:function(){this.template=_.template($("#user_template").html()),this.views={},setTimeout(_.bind(function(){this.model.child("campaigns").on("child_added",this.onCampaignAdded,this),this.model.child("campaigns").on("child_removed",this.onCampaignRemoved,this)},this))},destroy:function(){this.model.child("campaigns").off("child_added",this.onCampaignAdded,this),this.model.child("campaigns").off("child_removed",this.onCampaignRemoved,this),_.each(this.views,function(e){e.destroy(),e.remove()}),this.views={}},onCampaignAdded:function(e){console.log("onCampaignAdded",e.val());var t=e.val(),n=this.model.root().child("campaigns").child(t),s=new i({model:n});this.views[t]=s,this.$(".campaigns").append(s.render().el)},onCampaignRemoved:function(e){console.log("onCampaignRemoved",e.val());var i=e.val(),t=this.views[i];t.remove(),delete this.views[i]},onAddCampaign:function(){var e=this.$(".btn");if(!e.hasClass("disabled")){e.addClass("disabled"),setTimeout(function(){e.removeClass("disabled")},3e3);var i=this.$(".campaignName").val();if(i){this.$(".campaignName").val("");var t=this.model.root().child("campaigns").push().name(),n=this.model.root().child("campaigns").push({name:i,secret:t});this.model.child("campaigns").push().set(n.name())}}},render:function(){var e=this.$(".campaigns").children().detach();this.$el.html(this.template()),this.$(".campaigns").append(e)}});return t}),define("view/app",["./view","./login","./logout","./user"],function(e,i,t,n){"use strict";var s=e.extend({initialize:function(){this.template=_.template($("#app_template").html()),this.loginView=new i({model:this.model}),this.logoutView=new t({model:this.model}),this.onUser(),this.model.on("change:user",this.onUser,this)},onUser:function(){if(this.model.get("user")&&!this.userView){var e=this.model.get("user").id;this.userView=new n({model:this.model.firebase.child("users").child(e)})}else!this.model.get("user")&&this.userView&&(this.userView.destroy(),this.userView=null);this.render()},render:function(){return this.$el.html(this.template()),this.userView&&this.assign(this.userView,".user"),this.assign(this.loginView,".login"),this.assign(this.logoutView,".logout"),this}});return s}),require.config({paths:{hm:"vendor/hm",esprima:"vendor/esprima",jquery:"vendor/jquery.min",smoothie:"vendor/smoothie",underscore:"components/underscore/underscore-min",backbone:"components/backbone/backbone-min",humane:"components/Humane-Dates/humane"}}),require(["model/authentication","view/app"],function(e,i){"use strict";window.authentication=new e,$("body").append(new i({model:window.authentication}).render().el)}),define("main",function(){})})();